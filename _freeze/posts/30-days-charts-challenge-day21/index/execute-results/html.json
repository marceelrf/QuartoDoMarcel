{
  "hash": "5148085b90926e9ca0f33f26fc59974e",
  "result": {
    "markdown": "---\ntitle: \"30 days chart challenge - day 21\"\ndescription: \"down/upwards\"\nauthor: \"Marcel Ferreira\"\ndate: \"2023-04-21\"\ncategories: [R, Dataviz]\nimage: \"sao-paulo-fc_1985.png\"\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n-- Attaching core tidyverse packages ------------------------ tidyverse 2.0.0 --\nv dplyr     1.1.0     v readr     2.1.4\nv forcats   1.0.0     v stringr   1.5.0\nv ggplot2   3.4.1     v tibble    3.1.8\nv lubridate 1.9.2     v tidyr     1.3.0\nv purrr     1.0.1     \n-- Conflicts ------------------------------------------ tidyverse_conflicts() --\nx dplyr::filter() masks stats::filter()\nx dplyr::lag()    masks stats::lag()\ni Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n:::\n\n```{.r .cell-code}\nlibrary(ggtext)\nlibrary(rvest)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'rvest'\n\nThe following object is masked from 'package:readr':\n\n    guess_encoding\n```\n:::\n\n```{.r .cell-code}\nlibrary(extrafont)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nRegistering fonts with R\n```\n:::\n:::\n\n\n## Data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nurl <- \"https://en.wikipedia.org/wiki/2019_Campeonato_Brasileiro_S%C3%A9rie_A\"\n\n\n\n\nurl %>% \n  read_html() %>% \n  html_node(xpath = '//*[@id=\"mw-content-text\"]/div[1]/table[7]') %>% \n  html_table(fill = TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 20 x 11\n     Pos Team              Pld     W     D     L    GF    GA GD      Pts Quali~1\n   <int> <chr>           <int> <int> <int> <int> <int> <int> <chr> <int> <chr>  \n 1     1 Flamengo (C)       38    28     6     4    86    37 +49      90 \"Quali~\n 2     2 Santos             38    22     8     8    60    33 +27      74 \"Quali~\n 3     3 Palmeiras          38    21    11     6    61    32 +29      74 \"Quali~\n 4     4 Grêmio             38    19     8    11    64    39 +25      65 \"Quali~\n 5     5 Athletico Para~    38    18    10    10    51    32 +19      64 \"Quali~\n 6     6 São Paulo          38    17    12     9    39    30 +9       63 \"Quali~\n 7     7 Internacional      38    16     9    13    44    39 +5       57 \"Quali~\n 8     8 Corinthians        38    14    14    10    42    34 +8       56 \"Quali~\n 9     9 Fortaleza          38    15     8    15    50    49 +1       53 \"Quali~\n10    10 Goiás              38    15     7    16    46    64 -18      52 \"Quali~\n11    11 Bahia              38    12    13    13    44    43 +1       49 \"Quali~\n12    12 Vasco da Gama      38    12    13    13    39    45 -6       49 \"Quali~\n13    13 Atlético Minei~    38    13     9    16    45    49 -4       48 \"Quali~\n14    14 Fluminense         38    12    10    16    38    46 -8       46 \"Quali~\n15    15 Botafogo           38    13     4    21    31    45 -14      43 \"\"     \n16    16 Ceará              38    10     9    19    36    41 -5       39 \"\"     \n17    17 Cruzeiro (R)       38     7    15    16    27    46 -19      36 \"Releg~\n18    18 CSA (R)            38     8     8    22    24    58 -34      32 \"Releg~\n19    19 Chapecoense (R)    38     7    11    20    31    52 -21      32 \"Releg~\n20    20 Avaí (R)           38     3    11    24    18    62 -44      20 \"Releg~\n# ... with abbreviated variable name 1: `Qualification or relegation`\n```\n:::\n\n```{.r .cell-code}\nfinal_table <- list()\ntindex <- c(2,2,3,4,4,5,5,\n            6,6,6,9,9,8,7,7,7,7)\n\nfor(i in 1:17){\n  j <- 2005 + i\n  url <- glue::glue(\"https://en.wikipedia.org/wiki/{j}_Campeonato_Brasileiro_S%C3%A9rie_A\")\n  p1 <- tindex[i]\n  \n  \n  final_table[[i]] <- url %>% \n    read_html() %>% \n    html_node(xpath = glue::glue('//*[@id=\"mw-content-text\"]/div[1]/table[{p1}]')) %>% \n    html_table(fill = TRUE)\n  \n  print(j)\n}\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 2006\n[1] 2007\n[1] 2008\n[1] 2009\n[1] 2010\n[1] 2011\n[1] 2012\n[1] 2013\n[1] 2014\n[1] 2015\n[1] 2016\n[1] 2017\n[1] 2018\n[1] 2019\n[1] 2020\n[1] 2021\n[1] 2022\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nSPFC_pts <- final_table %>%\n  map(.f = \\(x) x %>% mutate(Team = str_replace(Team, \"\\\\(C\\\\)\",\"\"))) %>%\n  map(.f = \\(x) x %>% mutate(Team = str_replace(Team, \"\\\\(R\\\\)\",\"\"))) %>%\n  map(.f = \\(x) x %>% mutate(Team = str_replace(Team, \"\\\\[c\\\\]\",\"\"))) %>%\n  map(.f = \\(x) x %>% mutate(Team = str_replace_all(Team, \" \",\"_\"))) %>%\n  map(.f = \\(x) x %>% filter(Team == \"São_Paulo\")) %>%\n  map(.f = \\(x) x %>% pull((Pts))) %>%\n  map(.f = \\(x) x %>% as.numeric) %>%\n  unlist()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nSPFC_pts/114\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] 0.6842105 0.6754386 0.6578947 0.5701754 0.4824561 0.5175439 0.5789474\n [8] 0.4385965 0.6140351 0.5438596 0.4561404 0.4385965 0.5526316 0.5526316\n[15] 0.5789474 0.4210526 0.4736842\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nspfc_logo <- \"http://www.spfcpedia.com.br/logos/vetores/sao-paulo-fc_1985.png\"\n\n(p21 <- tibble(Points = SPFC_pts,\n       Year = 2006:2022) %>%\n  ggplot(aes(x = Year, y = Points, label = Points)) +\n  geom_line(linewidth = 1.15,col = \"grey35\") +\n  geom_point(color = \"#b20d15\", size = 3) +\n  geom_hline(yintercept = 57.5, linewidth = .1) +\n  ggrepel::geom_text_repel(family = \"College\",size = 8,\n                           force = .5) +\n  scale_x_continuous(breaks = 2006:2022) +\n  scale_y_continuous(breaks = seq(45,80,5)) + \n  labs(title = glue::glue(\"Sao Paulo FC's final points in the Br championships.\"),\n       x = \"\",y = \"\") + \n  theme(panel.background = element_rect(fill = \"white\",\n                                        colour = \"#b20d15\",\n                                        linewidth = 2),\n        panel.grid = element_blank(),\n        plot.title = element_text(family = \"College\",face = \"bold\",size = 20),\n        text = element_text(family = \"College\"),\n        axis.text = element_text(size = 15)) +\n  annotate(geom = \"rect\",\n           xmin = 2005,xmax = 2009,\n           ymin = 72,ymax = 79.8,col = \"#b20d15\",\n           alpha = .02, fill = \"red\") +\n  annotate(geom = \"text\",label = \"3x Champion\",\n           x = 2014,y = 76, family = \"College\", fontface = \"bold\",size = 8)+\n  annotate(geom=\"text\",label = \"50%\",\n           x = 2006,y = 58, family = \"serif\", fontface = \"bold\",size = 3)\n  ) \n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(cowplot)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'cowplot'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following object is masked from 'package:lubridate':\n\n    stamp\n```\n:::\n\n```{.r .cell-code}\nggdraw(p21) +\n  draw_image(image = \"sao-paulo-fc_1985.png\",\n              x = .91, y = .85, hjust = 1, vjust = 1, width = 0.13, height = 0.2)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggsave(filename = \"v1.png\",dpi = 600,width = 10)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nSaving 10 x 5 in image\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nspfc_df <- tibble(Points = SPFC_pts,\n       Year = 2006:2022) %>%\n  mutate(Pct = 100*SPFC_pts/114) %>%\n  mutate(Pct_diff = Pct - 57.5,\n         Pct_diff = round(Pct_diff,digits = 2)) %>% \n  mutate(Cond = case_when(\n    Pct_diff > 0 ~ \"up\",\n    Pct_diff < 0 ~ \"down\",\n    TRUE ~ \"Neutral\"\n    )\n    ) \n(p21_final <- spfc_df %>% \n  ggplot(aes(x = Year, y = Pct_diff, label = Pct_diff)) +\n  geom_col(fill = \"#b20d15\",alpha = .85) +\n  geom_text(data = filter(spfc_df, Cond == \"up\"),\n            family = \"College\",nudge_y = .5,fontface = \"bold\") +\n  geom_text(data = filter(spfc_df, Cond == \"down\"),\n            family = \"College\",nudge_y = -.5,fontface = \"bold\") +\n  scale_x_continuous(breaks = 2006:2022) +\n  scale_y_continuous(breaks = seq(-10,10,2.5)) +\n  labs(x=\"\", y=\"\",\n       title = \"Sao Paulo FC difference of a 50 percent campaign\",\n       caption = \"@marceelrf - Source: Wikipedia\") +\n  theme(panel.background = element_rect(fill = \"white\",\n                                        colour = \"#b20d15\",\n                                        linewidth = 2),\n        panel.grid = element_blank(),\n        plot.title = element_text(family = \"College\",face = \"bold\",size = 20),\n        text = element_text(family = \"College\"),\n        axis.text = element_text(size = 15)) +\n  annotate(geom = \"text\",label = \"3x Champion\",\n           x = 2007, y = -5,family = \"College\",fontface = \"bold\") +\n  annotate(\"segment\", x = 2006, xend = 2008, y = -2.25, yend = -2.25,col = \"#b20d15\",\n           arrow = arrow(ends = \"both\", angle = 90, length = unit(.2,\"cm\"))))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggdraw(p21_final) +\n  draw_image(image = \"sao-paulo-fc_1985.png\",\n              x = .91, y = .85, hjust = 1, vjust = 1, width = 0.13, height = 0.2)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n\n```{.r .cell-code}\nggsave(filename = \"day21_finalplot.png\",dpi = 600,width = 10)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nSaving 10 x 5 in image\n```\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}