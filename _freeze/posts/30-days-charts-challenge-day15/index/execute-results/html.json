{
  "hash": "44753553a5f18391ca314121302af58f",
  "result": {
    "markdown": "---\ntitle: \"30 days chart challenge - day 15\"\ndescription: \"positive/negative\"\nauthor: \"Marcel Ferreira\"\ndate: \"2023-04-15\"\ncategories: [R, Dataviz]\nimage: \"\"\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n-- Attaching core tidyverse packages ------------------------ tidyverse 2.0.0 --\nv dplyr     1.1.0     v readr     2.1.4\nv forcats   1.0.0     v stringr   1.5.0\nv ggplot2   3.4.1     v tibble    3.1.8\nv lubridate 1.9.2     v tidyr     1.3.0\nv purrr     1.0.1     \n-- Conflicts ------------------------------------------ tidyverse_conflicts() --\nx dplyr::filter() masks stats::filter()\nx dplyr::lag()    masks stats::lag()\ni Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n:::\n\n```{.r .cell-code}\nlibrary(brasileirao)\nlibrary(rvest)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'rvest'\n\nThe following object is masked from 'package:readr':\n\n    guess_encoding\n```\n:::\n\n```{.r .cell-code}\nlibrary(extrafont)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nRegistering fonts with R\n```\n:::\n:::\n\n\n## Data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nurl <- \"https://en.wikipedia.org/wiki/2019_Campeonato_Brasileiro_S%C3%A9rie_A\"\n\n\n\n\nurl %>% \n  read_html() %>% \n  html_node(xpath = '//*[@id=\"mw-content-text\"]/div[1]/table[7]') %>% \n  html_table(fill = TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 20 x 11\n     Pos Team              Pld     W     D     L    GF    GA GD      Pts Quali~1\n   <int> <chr>           <int> <int> <int> <int> <int> <int> <chr> <int> <chr>  \n 1     1 Flamengo (C)       38    28     6     4    86    37 +49      90 \"Quali~\n 2     2 Santos             38    22     8     8    60    33 +27      74 \"Quali~\n 3     3 Palmeiras          38    21    11     6    61    32 +29      74 \"Quali~\n 4     4 Grêmio             38    19     8    11    64    39 +25      65 \"Quali~\n 5     5 Athletico Para~    38    18    10    10    51    32 +19      64 \"Quali~\n 6     6 São Paulo          38    17    12     9    39    30 +9       63 \"Quali~\n 7     7 Internacional      38    16     9    13    44    39 +5       57 \"Quali~\n 8     8 Corinthians        38    14    14    10    42    34 +8       56 \"Quali~\n 9     9 Fortaleza          38    15     8    15    50    49 +1       53 \"Quali~\n10    10 Goiás              38    15     7    16    46    64 -18      52 \"Quali~\n11    11 Bahia              38    12    13    13    44    43 +1       49 \"Quali~\n12    12 Vasco da Gama      38    12    13    13    39    45 -6       49 \"Quali~\n13    13 Atlético Minei~    38    13     9    16    45    49 -4       48 \"Quali~\n14    14 Fluminense         38    12    10    16    38    46 -8       46 \"Quali~\n15    15 Botafogo           38    13     4    21    31    45 -14      43 \"\"     \n16    16 Ceará              38    10     9    19    36    41 -5       39 \"\"     \n17    17 Cruzeiro (R)       38     7    15    16    27    46 -19      36 \"Releg~\n18    18 CSA (R)            38     8     8    22    24    58 -34      32 \"Releg~\n19    19 Chapecoense (R)    38     7    11    20    31    52 -21      32 \"Releg~\n20    20 Avaí (R)           38     3    11    24    18    62 -44      20 \"Releg~\n# ... with abbreviated variable name 1: `Qualification or relegation`\n```\n:::\n\n```{.r .cell-code}\nfinal_table <- list()\ntindex <- c(2,2,3,4,4,5,5,\n            6,6,6,9,9,8,7,7,7,7)\n\nfor(i in 1:17){\n  j <- 2005 + i\n  url <- glue::glue(\"https://en.wikipedia.org/wiki/{j}_Campeonato_Brasileiro_S%C3%A9rie_A\")\n  p1 <- tindex[i]\n  \n  \n  final_table[[i]] <- url %>% \n    read_html() %>% \n    html_node(xpath = glue::glue('//*[@id=\"mw-content-text\"]/div[1]/table[{p1}]')) %>% \n    html_table(fill = TRUE)\n  \n  print(j)\n}\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 2006\n[1] 2007\n[1] 2008\n[1] 2009\n[1] 2010\n[1] 2011\n[1] 2012\n[1] 2013\n[1] 2014\n[1] 2015\n[1] 2016\n[1] 2017\n[1] 2018\n[1] 2019\n[1] 2020\n[1] 2021\n[1] 2022\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntab <- final_table %>%\n  map(.f = \\(x) x %>% mutate(Team = str_replace(Team, \"\\\\(C\\\\)\",\"\"))) %>%\n  map(.f = \\(x) x %>% mutate(Team = str_replace(Team, \"\\\\(R\\\\)\",\"\"))) %>%\n  map(.f = \\(x) x %>% mutate(Team = str_replace(Team, \"\\\\[c\\\\]\",\"\"))) %>%\n  map(.f = \\(x) x %>% mutate(Team = str_replace_all(Team, \" \",\"_\"))) %>%\n  map(.f = \\(x) x %>% mutate(Team = fix_names(Team))) %>%\n  map(.f = \\(x) x %>% select(Pos,Team)) %>%\n  reduce(.f = bind_rows) %>%\n  #Fix teams names\n  mutate(Team = str_replace(Team,\"América_Mineiro_\",\"América_Mineiro\")) %>%\n  mutate(Team = str_replace(Team,\"Athletico_Paranaense|\t\nAtlético_Paranaense\",\"Athletico PR\")) %>%\n  mutate(Team = str_replace(Team,\"Atlético_Goianiense_\",\"Atlético_Goianiense\")) %>%\n  mutate(Team = str_replace(Team,\"Atlético_Mineiro_\",\"Atlético_Mineiro\")) %>%\n  mutate(Team = str_replace(Team,\"Atlético_Goianiense_\",\"Atlético_Goianiense\")) %>%\n  mutate(Team = str_replace(Team,\"Avaí_\",\"Avaí\")) %>%\n  mutate(Team = str_replace(Team,\"Bahia_\",\"Bahia\")) %>%\n  mutate(Team = str_replace(Team,\"Botafogo_\",\"Botafogo\")) %>%\n  mutate(Team = str_replace(Team,\"CSA_\",\"CSA\")) %>%\n  mutate(Team = str_replace(Team,\"Ceará_\",\"Ceará\")) %>%\n  mutate(Team = str_replace(Team,\"Chapecoense_\",\"Chapecoense\")) %>%\n  mutate(Team = str_replace(Team,\"Corinthians_\",\"Corinthians\")) %>%\n  mutate(Team = str_replace(Team,\"Coritiba_\",\"Coritiba\")) %>%\n  mutate(Team = str_replace(Team,\"Vasco_da_Gama_\",\"Vasco\")) %>%\n  mutate(Team = str_replace(Team,\"Vasco_da_Gama\",\"Vasco\")) %>%\n  mutate(Team = str_replace(Team,\"Sport_do_Recife\",\"Sport\")) %>%\n  mutate(Team = str_replace(Team,\"Sport_Recife\",\"Sport\")) %>%\n  mutate(Team = str_replace(Team, \"_$\",\"\")) %>%\n  mutate(Team = str_replace_all(Team, \"_\",\" \"))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntab %>%\n  group_by(Team) %>%\n  summarise(Pos_min = max(Pos),\n            Pos_max = min(Pos)) %>%\n  mutate(Team = factor(Team)) %>%\n  mutate(Diff = abs(Pos_max - Pos_min)) %>%\n  mutate(Team = fct_reorder2(Team, (Diff),(Pos_max))) %>%\n  ggplot(aes(x = (Team))) +\n  geom_linerange(aes(ymin = Pos_min, ymax = Pos_max),\n                 size = 2, alpha = 0.25) +\n  geom_point(aes(y = Pos_min), col = \"dodgerblue\",size = 2,alpha = .75) +\n  geom_point(aes(y = Pos_max), col = \"red\",size = 2,alpha = .75) +\n  scale_y_reverse(n.breaks = 20) +\n  labs(x = \"\",y= \"\",\n       title = \"Range of positions of the teams in the Brazilian Serie A (2006~2022).\",\n       subtitle = \"Data from wikipedia\") +\n  coord_flip() +\n  theme_bw() +\n  theme(text = element_text(family = \"Book Antiqua\"),\n        panel.grid.minor = element_blank(),\n        axis.text = element_text(face = \"bold\",size = 10),\n        plot.title = element_text(face = \"bold\",size = 22),\n        panel.grid.major.y = element_blank(),\n        axis.ticks = element_blank())\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.\ni Please use `linewidth` instead.\n```\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggsave(filename = \"day15_finalplot.png\",dpi = 600,width = 12)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nSaving 12 x 5 in image\n```\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}