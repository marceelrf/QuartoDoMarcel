{
  "hash": "3b08c474ad3754a10ddee230bad0da1a",
  "result": {
    "markdown": "---\ntitle: \"30 days chart challenge - day 15\"\ndescription: \"positive/negative\"\nauthor: \"Marcel Ferreira\"\ndate: \"2023-04-15\"\ncategories: [R, Dataviz]\nimage: \"Campeonato_Brasileiro_Série_A_logo.png\"\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n-- Attaching core tidyverse packages ------------------------ tidyverse 2.0.0 --\nv dplyr     1.1.0     v readr     2.1.4\nv forcats   1.0.0     v stringr   1.5.0\nv ggplot2   3.4.1     v tibble    3.1.8\nv lubridate 1.9.2     v tidyr     1.3.0\nv purrr     1.0.1     \n-- Conflicts ------------------------------------------ tidyverse_conflicts() --\nx dplyr::filter() masks stats::filter()\nx dplyr::lag()    masks stats::lag()\ni Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n:::\n\n```{.r .cell-code}\nlibrary(brasileirao)\nlibrary(rvest)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'rvest'\n\nThe following object is masked from 'package:readr':\n\n    guess_encoding\n```\n:::\n\n```{.r .cell-code}\nlibrary(extrafont)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nRegistering fonts with R\n```\n:::\n:::\n\n\n## Data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nurl <- \"https://en.wikipedia.org/wiki/2019_Campeonato_Brasileiro_S%C3%A9rie_A\"\n\n\n\n\nurl %>% \n  read_html() %>% \n  html_node(xpath = '//*[@id=\"mw-content-text\"]/div[1]/table[7]') %>% \n  html_table(fill = TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 20 x 11\n     Pos Team              Pld     W     D     L    GF    GA GD      Pts Quali~1\n   <int> <chr>           <int> <int> <int> <int> <int> <int> <chr> <int> <chr>  \n 1     1 Flamengo (C)       38    28     6     4    86    37 +49      90 \"Quali~\n 2     2 Santos             38    22     8     8    60    33 +27      74 \"Quali~\n 3     3 Palmeiras          38    21    11     6    61    32 +29      74 \"Quali~\n 4     4 Grêmio             38    19     8    11    64    39 +25      65 \"Quali~\n 5     5 Athletico Para~    38    18    10    10    51    32 +19      64 \"Quali~\n 6     6 São Paulo          38    17    12     9    39    30 +9       63 \"Quali~\n 7     7 Internacional      38    16     9    13    44    39 +5       57 \"Quali~\n 8     8 Corinthians        38    14    14    10    42    34 +8       56 \"Quali~\n 9     9 Fortaleza          38    15     8    15    50    49 +1       53 \"Quali~\n10    10 Goiás              38    15     7    16    46    64 -18      52 \"Quali~\n11    11 Bahia              38    12    13    13    44    43 +1       49 \"Quali~\n12    12 Vasco da Gama      38    12    13    13    39    45 -6       49 \"Quali~\n13    13 Atlético Minei~    38    13     9    16    45    49 -4       48 \"Quali~\n14    14 Fluminense         38    12    10    16    38    46 -8       46 \"Quali~\n15    15 Botafogo           38    13     4    21    31    45 -14      43 \"\"     \n16    16 Ceará              38    10     9    19    36    41 -5       39 \"\"     \n17    17 Cruzeiro (R)       38     7    15    16    27    46 -19      36 \"Releg~\n18    18 CSA (R)            38     8     8    22    24    58 -34      32 \"Releg~\n19    19 Chapecoense (R)    38     7    11    20    31    52 -21      32 \"Releg~\n20    20 Avaí (R)           38     3    11    24    18    62 -44      20 \"Releg~\n# ... with abbreviated variable name 1: `Qualification or relegation`\n```\n:::\n\n```{.r .cell-code}\nfinal_table <- list()\ntindex <- c(2,2,3,4,4,5,5,\n            6,6,6,9,9,8,7,7,7,7)\n\nfor(i in 1:17){\n  j <- 2005 + i\n  url <- glue::glue(\"https://en.wikipedia.org/wiki/{j}_Campeonato_Brasileiro_S%C3%A9rie_A\")\n  p1 <- tindex[i]\n  \n  \n  final_table[[i]] <- url %>% \n    read_html() %>% \n    html_node(xpath = glue::glue('//*[@id=\"mw-content-text\"]/div[1]/table[{p1}]')) %>% \n    html_table(fill = TRUE)\n  \n  print(j)\n}\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 2006\n[1] 2007\n[1] 2008\n[1] 2009\n[1] 2010\n[1] 2011\n[1] 2012\n[1] 2013\n[1] 2014\n[1] 2015\n[1] 2016\n[1] 2017\n[1] 2018\n[1] 2019\n[1] 2020\n[1] 2021\n[1] 2022\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nnames(final_table) <- 2006:2022\n\n(tab <- final_table %>%\n  map(.f = \\(x) x %>% mutate(Team = str_replace(Team, \"\\\\(C\\\\)\",\"\"))) %>%\n  map(.f = \\(x) x %>% mutate(Team = str_replace(Team, \"\\\\(R\\\\)\",\"\"))) %>%\n  map(.f = \\(x) x %>% mutate(Team = str_replace(Team, \"\\\\[c\\\\]\",\"\"))) %>%\n  map(.f = \\(x) x %>% mutate(Team = str_replace_all(Team, \" \",\"_\"))) %>%\n  map(.f = \\(x) x %>% mutate(Team = fix_names(Team))) %>%\n  map(.f = \\(x) x %>% select(Team,GD)) %>%\n  map_df(~as.data.frame(.x),.id = \"id\") %>% \n  #Fix teams names\n  mutate(Team = str_replace(Team,\"América_Mineiro_\",\"América_Mineiro\")) %>%\n  mutate(Team = str_replace(Team,\"Athletico_Paranaense|\nAtlético_Paranaense\",\"Athletico PR\")) %>%\n  mutate(Team = str_replace(Team,\"Atlético_Goianiense_\",\"Atlético_Goianiense\")) %>%\n  mutate(Team = str_replace(Team,\"Atlético_Mineiro_\",\"Atlético_Mineiro\")) %>%\n  mutate(Team = str_replace(Team,\"Atlético_Goianiense_\",\"Atlético_Goianiense\")) %>%\n  mutate(Team = str_replace(Team,\"Avaí_\",\"Avaí\")) %>%\n  mutate(Team = str_replace(Team,\"Bahia_\",\"Bahia\")) %>%\n  mutate(Team = str_replace(Team,\"Botafogo_\",\"Botafogo\")) %>%\n  mutate(Team = str_replace(Team,\"CSA_\",\"CSA\")) %>%\n  mutate(Team = str_replace(Team,\"Ceará_\",\"Ceará\")) %>%\n  mutate(Team = str_replace(Team,\"Chapecoense_\",\"Chapecoense\")) %>%\n  mutate(Team = str_replace(Team,\"Corinthians_\",\"Corinthians\")) %>%\n  mutate(Team = str_replace(Team,\"Coritiba_\",\"Coritiba\")) %>%\n  mutate(Team = str_replace(Team,\"Vasco_da_Gama_\",\"Vasco\")) %>%\n  mutate(Team = str_replace(Team,\"Vasco_da_Gama\",\"Vasco\")) %>%\n  mutate(Team = str_replace(Team,\"Sport_do_Recife\",\"Sport\")) %>%\n  mutate(Team = str_replace(Team,\"Sport_Recife\",\"Sport\")) %>%\n  mutate(Team = str_replace(Team, \"_$\",\"\")) %>%\n  mutate(Team = str_replace_all(Team, \"_\",\" \")) %>%\n  mutate(GD = str_replace(GD, pattern = \"\\\\+\",\"\")) %>%\n  mutate(GD = str_replace(GD,\n                          pattern = regex(\"\\\\D+\",negate = TRUE),\n                          replacement = \"-\")) %>%\n    mutate(GD = as.numeric(GD))\n  )\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: There was 1 warning in `mutate()`.\ni In argument: `GD = str_replace(GD, pattern = regex(\"\\\\D+\", negate = TRUE),\n  replacement = \"-\")`.\nCaused by warning in `stri_opts_regex()`:\n! Unknown option to `stri_opts_regex`.\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n      id                Team  GD\n1   2006           São Paulo  34\n2   2006       Internacional  16\n3   2006              Grêmio  19\n4   2006              Santos  21\n5   2006              Paraná   7\n6   2006               Vasco   7\n7   2006         Figueirense  13\n8   2006               Goiás  14\n9   2006         Corinthians  -5\n10  2006            Cruzeiro   7\n11  2006            Flamengo  -4\n12  2006            Botafogo   2\n13  2006        Athletico PR  -1\n14  2006           Juventude -10\n15  2006          Fluminense -10\n16  2006           Palmeiras -12\n17  2006         Ponte Preta -20\n18  2006           Fortaleza -23\n19  2006         São Caetano -16\n20  2006          Santa Cruz -34\n21  2007           São Paulo  36\n22  2007              Santos  10\n23  2007            Flamengo   6\n24  2007          Fluminense  18\n25  2007            Cruzeiro  14\n26  2007              Grêmio   1\n27  2007           Palmeiras   1\n28  2007    Atlético Mineiro  12\n29  2007            Botafogo   4\n30  2007               Vasco  11\n31  2007       Internacional   5\n32  2007 Atlético Paranaense   1\n33  2007         Figueirense   1\n34  2007               Sport  -1\n35  2007             Náutico   3\n36  2007               Goiás -13\n37  2007         Corinthians -10\n38  2007              Paraná -22\n39  2007           Juventude -22\n40  2007          América RN -56\n41  2008           São Paulo  30\n42  2008              Grêmio  24\n43  2008            Cruzeiro  15\n44  2008           Palmeiras  10\n45  2008            Flamengo  19\n46  2008       Internacional   1\n47  2008            Botafogo   7\n48  2008               Goiás  10\n49  2008            Coritiba   7\n50  2008             Vitória   4\n51  2008               Sport   3\n52  2008    Atlético Mineiro -11\n53  2008 Atlético Paranaense  -9\n54  2008          Fluminense   1\n55  2008              Santos  -9\n56  2008             Náutico -10\n57  2008         Figueirense -23\n58  2008               Vasco -16\n59  2008          Portuguesa -22\n60  2008            Ipatinga -29\n61  2009            Flamengo  14\n62  2009       Internacional  21\n63  2009           São Paulo  15\n64  2009            Cruzeiro   5\n65  2009           Palmeiras  13\n66  2009                Avaí   9\n67  2009    Atlético Mineiro  -1\n68  2009              Grêmio  21\n69  2009               Goiás  -1\n70  2009         Corinthians  -4\n71  2009             Barueri   7\n72  2009              Santos   0\n73  2009             Vitória  -6\n74  2009 Atlético Paranaense  -7\n75  2009            Botafogo  -6\n76  2009          Fluminense  -7\n77  2009            Coritiba -12\n78  2009         Santo André -15\n79  2009             Náutico -23\n80  2009               Sport -23\n81  2010          Fluminense  26\n82  2010            Cruzeiro  15\n83  2010         Corinthians  24\n84  2010              Grêmio  25\n85  2010 Atlético Paranaense  -2\n86  2010            Botafogo  12\n87  2010       Internacional   7\n88  2010              Santos  13\n89  2010           São Paulo   0\n90  2010           Palmeiras  -1\n91  2010               Vasco  -2\n92  2010               Ceará  -9\n93  2010    Atlético Mineiro -12\n94  2010            Flamengo  -3\n95  2010                Avaí  -9\n96  2010 Atlético Goianiense  -6\n97  2010             Vitória  -6\n98  2010             Guarani -20\n99  2010               Goiás -27\n100 2010             Barueri -25\n101 2011         Corinthians  17\n102 2011               Vasco  17\n103 2011          Fluminense   9\n104 2011            Flamengo  12\n105 2011       Internacional  14\n106 2011           São Paulo  11\n107 2011         Figueirense   1\n108 2011            Coritiba  16\n109 2011            Botafogo   3\n110 2011              Santos   0\n111 2011           Palmeiras   4\n112 2011              Grêmio  -8\n113 2011 Atlético Goianiense   5\n114 2011               Bahia  -6\n115 2011    Atlético Mineiro -10\n116 2011            Cruzeiro  -3\n117 2011 Atlético Paranaense -17\n118 2011               Ceará -17\n119 2011     América Mineiro -18\n120 2011                Avaí -30\n121 2012          Fluminense  28\n122 2012    Atlético Mineiro  27\n123 2012              Grêmio  23\n124 2012           São Paulo  22\n125 2012               Vasco   1\n126 2012         Corinthians  12\n127 2012            Botafogo  10\n128 2012              Santos   6\n129 2012            Cruzeiro  -4\n130 2012       Internacional   4\n131 2012            Flamengo  -7\n132 2012             Náutico  -7\n133 2012            Coritiba  -7\n134 2012         Ponte Preta  -7\n135 2012               Bahia  -4\n136 2012          Portuguesa  -2\n137 2012               Sport -17\n138 2012           Palmeiras -15\n139 2012 Atlético Goianiense -30\n140 2012         Figueirense -33\n141 2013            Cruzeiro  40\n142 2013              Grêmio   7\n143 2013 Atlético Paranaense  16\n144 2013            Botafogo  14\n145 2013             Vitória   6\n146 2013               Goiás   4\n147 2013              Santos  13\n148 2013    Atlético Mineiro  11\n149 2013           São Paulo  -1\n150 2013         Corinthians   5\n151 2013            Coritiba  -3\n152 2013               Bahia  -8\n153 2013       Internacional  -1\n154 2013            Criciúma -14\n155 2013          Fluminense  -4\n156 2013            Flamengo  -3\n157 2013          Portuguesa   4\n158 2013               Vasco -11\n159 2013         Ponte Preta -18\n160 2013             Náutico -57\n161 2014            Cruzeiro  29\n162 2014           São Paulo  19\n163 2014       Internacional  12\n164 2014         Corinthians  18\n165 2014    Atlético Mineiro  13\n166 2014          Fluminense  19\n167 2014              Grêmio  12\n168 2014 Atlético Paranaense   1\n169 2014              Santos   7\n170 2014            Flamengo  -1\n171 2014               Sport -10\n172 2014               Goiás  -2\n173 2014         Figueirense -10\n174 2014            Coritiba  -3\n175 2014         Chapecoense  -5\n176 2014           Palmeiras -25\n177 2014             Vitória -17\n178 2014               Bahia -12\n179 2014            Botafogo -17\n180 2014            Criciúma -28\n181 2015         Corinthians  40\n182 2015    Atlético Mineiro  18\n183 2015              Grêmio  20\n184 2015           São Paulo   6\n185 2015       Internacional   1\n186 2015               Sport  15\n187 2015              Santos  18\n188 2015            Cruzeiro   9\n189 2015           Palmeiras   9\n190 2015 Atlético Paranaense  -5\n191 2015         Ponte Preta   1\n192 2015            Flamengo  -8\n193 2015          Fluminense  -9\n194 2015         Chapecoense -10\n195 2015            Coritiba -11\n196 2015         Figueirense -14\n197 2015                Avaí -22\n198 2015               Vasco -26\n199 2015               Goiás -10\n200 2015           Joinville -22\n201 2016           Palmeiras  30\n202 2016              Santos  24\n203 2016            Flamengo  17\n204 2016    Atlético Mineiro   8\n205 2016            Botafogo   4\n206 2016 Atlético Paranaense   6\n207 2016         Corinthians   6\n208 2016         Ponte Preta  -4\n209 2016              Grêmio  -3\n210 2016           São Paulo   8\n211 2016         Chapecoense  -7\n212 2016            Cruzeiro  -1\n213 2016          Fluminense   0\n214 2016               Sport  -6\n215 2016            Coritiba  -1\n216 2016             Vitória  -2\n217 2016       Internacional  -6\n218 2016         Figueirense -20\n219 2016          Santa Cruz -24\n220 2016     América Mineiro -35\n221 2017         Corinthians  20\n222 2017           Palmeiras  16\n223 2017              Santos  10\n224 2017              Grêmio  19\n225 2017            Cruzeiro   8\n226 2017            Flamengo  11\n227 2017               Vasco  -7\n228 2017         Chapecoense  -2\n229 2017    Atlético Mineiro   3\n230 2017            Botafogo   3\n231 2017 Atlético Paranaense   2\n232 2017               Bahia   2\n233 2017           São Paulo  -1\n234 2017          Fluminense  -3\n235 2017               Sport -12\n236 2017             Vitória  -8\n237 2017            Coritiba  -9\n238 2017                Avaí -19\n239 2017         Ponte Preta -15\n240 2017 Atlético Goianiense -18\n241 2018           Palmeiras  38\n242 2018            Flamengo  30\n243 2018       Internacional  22\n244 2018              Grêmio  21\n245 2018           São Paulo  12\n246 2018    Atlético Mineiro  13\n247 2018 Atlético Paranaense  17\n248 2018            Cruzeiro   0\n249 2018            Botafogo  -8\n250 2018              Santos   6\n251 2018               Bahia  -2\n252 2018          Fluminense -14\n253 2018         Corinthians  -1\n254 2018         Chapecoense -16\n255 2018               Ceará  -6\n256 2018               Vasco  -7\n257 2018     América Mineiro -17\n258 2018               Sport -22\n259 2018             Vitória -27\n260 2018              Paraná -39\n261 2019            Flamengo  49\n262 2019              Santos  27\n263 2019           Palmeiras  29\n264 2019              Grêmio  25\n265 2019        Athletico PR  19\n266 2019           São Paulo   9\n267 2019       Internacional   5\n268 2019         Corinthians   8\n269 2019           Fortaleza   1\n270 2019               Goiás -18\n271 2019               Bahia   1\n272 2019               Vasco  -6\n273 2019    Atlético Mineiro  -4\n274 2019          Fluminense  -8\n275 2019            Botafogo -14\n276 2019               Ceará  -5\n277 2019            Cruzeiro -19\n278 2019                 CSA -34\n279 2019         Chapecoense -21\n280 2019                Avaí -44\n281 2020            Flamengo  20\n282 2020       Internacional  26\n283 2020    Atlético Mineiro  19\n284 2020           São Paulo  18\n285 2020          Fluminense  13\n286 2020              Grêmio  13\n287 2020           Palmeiras  14\n288 2020              Santos   1\n289 2020        Athletico PR   2\n290 2020 Red Bull Bragantino  10\n291 2020               Ceará   3\n292 2020         Corinthians   0\n293 2020 Atlético Goianiense  -5\n294 2020               Bahia -11\n295 2020               Sport -19\n296 2020           Fortaleza -10\n297 2020               Vasco -19\n298 2020               Goiás -22\n299 2020            Coritiba -23\n300 2020            Botafogo -30\n301 2021    Atlético Mineiro  33\n302 2021            Flamengo  33\n303 2021           Palmeiras  15\n304 2021           Fortaleza  -1\n305 2021         Corinthians   4\n306 2021 Red Bull Bragantino   9\n307 2021          Fluminense   0\n308 2021     América Mineiro   4\n309 2021 Atlético Goianiense  -3\n310 2021              Santos  -5\n311 2021               Ceará   1\n312 2021       Internacional   2\n313 2021           São Paulo  -8\n314 2021        Athletico PR  -4\n315 2021              Cuiabá  -3\n316 2021           Juventude  -8\n317 2021              Grêmio  -7\n318 2021               Bahia  -9\n319 2021               Sport -13\n320 2021         Chapecoense -40\n321 2022           Palmeiras  39\n322 2022       Internacional  27\n323 2022          Fluminense  22\n324 2022         Corinthians   8\n325 2022            Flamengo  21\n326 2022        Athletico PR   0\n327 2022    Atlético Mineiro   8\n328 2022           Fortaleza   7\n329 2022           São Paulo  13\n330 2022     América Mineiro   0\n331 2022            Botafogo  -2\n332 2022              Santos   3\n333 2022               Goiás -13\n334 2022 Red Bull Bragantino -10\n335 2022            Coritiba -21\n336 2022              Cuiabá -11\n337 2022               Ceará  -7\n338 2022 Atlético Goianiense -18\n339 2022                Avaí -26\n340 2022           Juventude -40\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nTeam_oreder <- tab %>%\n  group_by(Team) %>%\n  count(sort = TRUE) %>%\n  pull(Team)\n\ncol1 <- c(\"#DE3939\", \"#948E8E\", \"#0357D6\", \"#FEFFE5\")\n\ntab %>%\n  mutate(Team = factor(Team, levels = rev(Team_oreder)),\n         Class = case_when(\n           GD > 0 ~ \"positive\",\n           GD < 0 ~ \"negative\",\n           TRUE ~ \"neutral\"\n         )) %>%\n  # mutate(Diff = abs(Pos_max - Pos_min)) %>%\n  # mutate(Team = fct_reorder2(Team, (Diff),(Pos_max))) %>%\n  ggplot(aes(x = (id), y = Team, fill = Class))+\n  geom_tile(col = \"black\") +\n  scale_fill_manual(values = c(\"positive\" = col1[1],\n                               \"negative\" = col1[3],\n                               \"neutral\" = col1[2])) +\n  labs(x = \"\",y= \"\",\n       title = \"Did your team have a positive goal difference?\",\n       subtitle = \"Gol differences of the teams in the Brazilian Serie A (2006~2022). Data from wikipedia.\") +\n  theme_bw() +\n  theme(text = element_text(family = \"Book Antiqua\"),\n        panel.grid.minor = element_blank(),\n        axis.text = element_text(face = \"bold\",size = 10),\n        plot.title = element_text(face = \"bold\",size = 22),\n        panel.grid.major = element_blank(),\n        axis.ticks = element_blank(),\n        plot.background = element_rect(fill = col1[4]),\n        legend.background = element_rect(fill = col1[4]),\n        legend.title = element_blank())\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggsave(filename = \"day15_finalplot.png\",dpi = 600,width = 12,height = 10)\n```\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}